# Spec Baseline v0.3.2

## MVP 1: 드랍인 신청/안내 + 운영자 결제확정(승인) 운영

> 이 문서는 “무엇을 만들지(WHAT) / 어디까지 할지(SCOPE) / 핵심 규칙(RULES)”의 기준점입니다.

---

## 1) 목적

- 해결하려는 문제:
  - 박스 운영자가 드랍인/무료체험 문의를 DM/메시지로 1:1 응대하며 반복 안내/누락 발생
  - 명단 최신화 지연으로 현장 혼선 발생
  - 위 운영 비용을 줄인다
- 이번 MVP에서 증명하려는 것(가설):
  - “링크 기반 신청 + 자동 안내 + 운영자 결제확정(승인) + 운영자 알림”만으로도
    1. 드랍인 응대 시간을 줄이고
    2. 명단 최신화 지연으로 인한 현장 혼선을 줄일 수 있다

---

## 2) 사용자와 핵심 플로우

### 사용자 1: 드랍인/회원(신청자)

- 링크 접속 → 시간 선택 → 이름/전화번호 입력(이메일 선택)
- 신청 생성(`PENDING_PAYMENT`)
- 안내에 따라 입금
- 상태 확인(조회 링크: 토큰)

### 사용자 2: 박스 운영자

- 슬롯/정원 설정
- 신청 발생 알림(이메일) 수신
- 콘솔에서 결제 확인 후 승인
- 확정(`CONFIRMED`) 또는 대기(`WAITLISTED`)

### 보조 사용자(백로그): 현장 코치/리셉션

- 오늘 방문 예정자 목록 “읽기 전용” 확인(승인 권한 없음) — MVP 제외

---

## 3) 제품 범위(Scope)

### In-scope

- 요일 반복 템플릿 기반 타임슬롯/정원 관리
- 특정 날짜 비활성화(휴무/대관/대회 등 예외 처리)
- 드랍인 신청 저장(이름 + 전화번호 필수, 이메일 선택)
- 신청 상태 관리
  - `PENDING_PAYMENT / CONFIRMED / WAITLISTED / CANCELED`
- 운영자 콘솔에서 신청 목록 조회 및 결제확정(승인) 처리
- 운영자 알림(이메일): 신청 생성 시 즉시 발송(명단 최신화를 위한 실시간성 확보)
- 신청자 조회 링크(토큰 기반): 로그인 없이 본인 상태 확인
- 운영자 콘솔에 WAITLISTED 안내 템플릿(복붙용) 제공

### Non-goals (MVP에서 하지 않음)

- PG 결제 내장(카드/간편결제), 자동 환불/노쇼 정산
- 카톡/인스타DM/네이버카페 통합 인박스
- 출석/재등록/이탈 대시보드
- 회원 커뮤니티/피드/기록 기능
- 현장 코치/리셉션용 읽기 전용 명단 화면(백로그)
- 멀티 지점 전용 기능(백로그)
- 상태 변경 시 신청자 자동 알림(이메일/SMS)
- 신청자 자가 취소 기능

---

## 4) 배포/도메인 경계

- 공개 도메인: `example.com` (드랍인 신청/안내/상태 조회)
- 운영자 도메인: `admin.example.com` (운영자 콘솔)

### 경계 원칙

- 개인정보(연락처 포함) 조회/관리 기능은 운영자 도메인에서만 제공
- 공개 도메인에서는 토큰 기반 조회 링크로만 상태 확인 가능
- 공개 도메인에서 PII는 미노출 또는 마스킹

---

## 5) 인증/권한

### 운영자 로그인

- 이메일 기반 매직 링크(Passwordless)

### 세션/쿠키

- 운영자 세션은 `admin.example.com`에서만 유효한 host-only 쿠키로 유지(도메인 공유 금지)

### 권한 모델

- MVP: 운영자 단일 역할(읽기/승인/취소)
  - 취소는 운영자만 가능
- 백로그: 현장 코치/리셉션 “읽기 전용” 역할 추가(승인 권한 없음)

---

## 6) 데이터/도메인 모델(최소)

### 엔티티

- Box: 박스 기본 정보(주소/안내문/계좌/정책 텍스트/운영자 이메일 등)
- SlotTemplate: 요일/시간 단위 반복 템플릿(정원 포함)
- SlotException: 특정 날짜 비활성화(또는 정원/시간 변경) 예외
- Booking: 신청 정보 + 상태 + 조회 토큰/만료

### Booking 상태

- `PENDING_PAYMENT`: 신청 완료, 결제 대기(확정 아님)
- `CONFIRMED`: 운영자가 결제 확인 후 확정
- `WAITLISTED`: 정원 초과로 대기
- `CANCELED`: 취소

### 핵심 규칙(Rules)

1. 확정(CONFIRMED)의 정의 = 운영자 결제 확인 완료
2. 정원(capacity)은 CONFIRMED 기준으로 카운트한다
3. 운영자 승인 시점에 정원을 평가한다
   - 여유 있으면 CONFIRMED
   - 초과면 WAITLISTED
4. 신청자는 로그인 없이 토큰 기반 조회 링크로 본인 상태를 확인한다
5. 운영자 알림은 “편의”뿐 아니라 “명단 최신화(현장 혼선 방지)” 목적을 가진다
6. 조회 링크 토큰 정책
   - 토큰은 Booking 생성 시 1회 발급
   - 상태 변경 시 토큰 재발급 없음(링크 불변)
   - TTL: 생성일 기준 30일
   - 만료 이후에는 해당 링크로 상태 조회 불가(재발급은 운영 프로세스로 처리)

---

## 7) 알림/커뮤니케이션

- 운영자 알림: 이메일(신청 생성 시 즉시 발송)
  - 목적: 실시간 명단 최신화(무료체험/드랍인 방문자 사전 인지)
- 신청자 알림: MVP 필수 아님
  - 완료 화면 + 조회 링크 제공으로 대체
- WAITLISTED 운영 커뮤니케이션
  - 자동 알림/자동 환불 없음
  - 운영자 콘솔에서 안내 템플릿 제공 → 운영자가 수동 안내

---

## 8) 기술 스택(결정만)

- Next.js(App Router) 단일 앱
- 도메인: `example.com` + `admin.example.com` (단일 배포에 도메인 2개 연결)
- DB: Managed Postgres(Supabase/Neon 중 택1)
- 이메일: 트랜잭션 이메일 서비스(Resend 등)
- 호스팅: Vercel 등

---

## 9) 성공 기준(KPI)

- 운영자: 1:1 문의/응대 시간 감소(주간 기록)
- 퍼널: 링크 클릭 대비 신청 생성률, 신청 대비 CONFIRMED 전환율
- 운영 안정성
  - 오버부킹 0건(파일럿 기간)
  - 당일 “예고 없는 방문” 케이스 감소(운영자 주관 기록)

---

## 10) 리스크/오픈 이슈

### 리스크

- 동시 승인/정원 계산 시 오버부킹
- 스팸 신청/악성 입력
- 결제 확인 지연으로 커뮤니케이션 비용 증가
- 외부 예약 채널 병행 시 정책/정원 혼선

### 오픈 이슈(결정 필요하지만 MVP 진행 가능)

- 스팸 방지 수준(레이트리밋/캡차/블랙리스트 등) 범위
- 토큰 만료 이후 재발급 운영 방식(운영자 콘솔 “링크 재발급” 버튼 제공 여부)
- WAITLISTED 대기자 승격(자리가 나면 CONFIRMED) 자동화 범위
- 외부 예약 채널 병행 시 운영 가이드 문구 제공 여부
